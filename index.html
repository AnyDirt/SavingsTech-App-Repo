<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Geotagging Candidates (Foursquare API)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 20px;
      padding: 20px;
    }
    h1 {
      color: #0070C0;
    }
    input, button {
      padding: 8px;
      font-size: 16px;
      margin: 5px;
    }
    ul {
      list-style-type: none;
      padding-left: 0;
    }
    li {
      background: white;
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 6px;
    }
  </style>
</head>
<body>

  <h1>Foursquare Geotagging Candidates</h1>

  <label for="lat">Latitude:</label>
  <input type="text" id="lat" value="41.9376858">
  <label for="lon">Longitude:</label>
  <input type="text" id="lon" value="-72.7181456">
  <button onclick="fetchCandidates()">Search</button>

  <ul id="results"></ul>

  <script>
    async function fetchCandidates() {
      const lat = document.getElementById("lat").value;
      const lon = document.getElementById("lon").value;

      // const url = `https://places-api.foursquare.com/geotagging/candidates?fields=name%2Cdistance%2Ccategories&ll=${lat}%2C${lon}&limit=10`;
      const url = `/.netlify/functions/geotag?lat=${lat}&lon=${lon}`;

      const options = {
        method: 'GET',
        headers: {
          accept: 'application/json',
          'X-Places-Api-Version': '2025-06-17',
          authorization: 'Bearer IUZB2GYBKUQ3Q1P2D2AHCNRZ2QWD321AXJHH1EVT1RGGE1AC'
        }
      };

      const resultsContainer = document.getElementById('results');
      resultsContainer.innerHTML = 'Loading...';

      try {
        const res = await fetch(url, options);
        const data = await res.json();
        resultsContainer.innerHTML = '';

        if (data?.results?.length > 0) {
          data.results.forEach(place => {
            const li = document.createElement('li');
            const categories = place.categories.map(cat => cat.name).join(', ');
            li.innerHTML = `<strong>${place.name}</strong><br>
                            Distance: ${place.distance} meters<br>
                            Categories: ${categories}`;
            resultsContainer.appendChild(li);
          });
        } else {
          resultsContainer.innerHTML = '<li>No results found.</li>';
        }
      } catch (err) {
        console.error(err);
        resultsContainer.innerHTML = '<li>Error fetching data.</li>';
      }
    }

    // Fetch default location on load
    window.onload = fetchCandidates;
  </script>

</body>
</html>
