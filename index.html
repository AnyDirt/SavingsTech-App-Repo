<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Geotagging Candidates (Foursquare API)</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 20px;
      padding: 20px;
    }
    h1 {
      color: #0070C0;
    }
    input, button {
      padding: 8px;
      font-size: 16px;
      margin: 5px;
    }
    ul {
      list-style-type: none;
      padding-left: 0;
    }
    li {
      background: white;
      border: 1px solid #ccc;
      padding: 10px;
      margin-bottom: 10px;
      border-radius: 6px;
    }
  </style>
</head>
<body>

  <h1>Foursquare Geotagging Candidates</h1>

  <label for="lat">Latitude:</label>
  <input type="text" id="lat" value="41.9376858">
  <label for="lon">Longitude:</label>
  <input type="text" id="lon" value="-72.7181456">
  <button onclick="fetchCandidates()">Search</button>

  <ul id="results"></ul>


<script>
async function fetchCandidates() {
  const lat = document.getElementById("lat").value;
  const lon = document.getElementById("lon").value;

  const url = `/.netlify/functions/geotag?lat=${lat}&lon=${lon}&limit=10`;

  const el = document.getElementById('results');
  el.innerHTML = 'Loading…';

  try {
    const res = await fetch(url);
    const payload = await res.json();

    // Look for "candidates" array (main output of this endpoint)
    const raw = payload?.data;
    const list = raw?.candidates ?? [];

    el.innerHTML = '';
    if (Array.isArray(list) && list.length) {
      list.forEach(p => {
        const li = document.createElement('li');
        const cats = (p.categories || []).map(c => c.name).join(', ');
        li.innerHTML = `<strong>${p.name ?? '(no name)'}</strong><br>
                        Distance: ${p.distance ?? '—'} m<br>
                        Categories: ${cats || '—'}`;
        el.appendChild(li);
      });
    } else {
      // Debug block helps check exact payload if empty
      el.innerHTML = `<li>No results found.</li>
                      <li style="white-space:pre; font-size:12px; opacity:.7">
                        debug: ${JSON.stringify(payload).slice(0, 800)}…
                      </li>`;
    }
  } catch (e) {
    console.error(e);
    el.innerHTML = '<li>Error fetching data.</li>';
  }
}

window.onload = fetchCandidates;
</script>


</body>
</html>
